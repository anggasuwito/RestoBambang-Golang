create database resto;
use resto;

create table jenis(
id_jenis int not null primary key auto_increment,
nama_jenis varchar(100)
);
insert into jenis(nama_jenis)values("makanan");
insert into jenis(nama_jenis)values("minuman");

create table menu(
id_menu int not null primary key auto_increment,
id_jenis int,
nama_menu varchar(100));
insert into menu(id_jenis,nama_menu)values(1,"nasi goreng");
insert into menu(id_jenis,nama_menu)values(1,"ikan bakar");
insert into menu(id_jenis,nama_menu)values(2,"aqua");
insert into menu(id_jenis,nama_menu)values(2,"teh botol");

create table harga_menu(
id_harga_menu int not null primary key auto_increment,
id_menu int,
tanggal date,
harga int);
insert into harga_menu(id_menu,tanggal,harga)values(1,"2020-07-20",15000);
insert into harga_menu(id_menu,tanggal,harga)values(1,"2020-07-20",50000);
insert into harga_menu(id_menu,tanggal,harga)values(2,"2020-07-20",25000);
insert into harga_menu(id_menu,tanggal,harga)values(3,"2020-07-20",5000);
insert into harga_menu(id_menu,tanggal,harga)values(4,"2020-07-20",8000);
select * from harga_menu;
create table stok_menu(
id_stok_menu int not null primary key auto_increment,
id_menu int,
tanggal date,
stok int);
insert into stok_menu(id_menu,tanggal,stok)values(1,"2020-07-20",15);
insert into stok_menu(id_menu,tanggal,stok)values(2,"2020-07-20",0);
insert into stok_menu(id_menu,tanggal,stok)values(3,"2020-07-20",25);
insert into stok_menu(id_menu,tanggal,stok)values(4,"2020-07-20",0);

create table ekstra_menu(
id_ekstra int not null primary key auto_increment,
nama_ekstra_menu varchar(100),
harga_ekstra_menu int);
insert into ekstra_menu(nama_ekstra_menu,harga_ekstra_menu)values("no extra",0);
insert into ekstra_menu(nama_ekstra_menu,harga_ekstra_menu)values("ekstra pedas",10000);
insert into ekstra_menu(nama_ekstra_menu,harga_ekstra_menu)values("tambah gula",1000);

create table transaksi(
id_transaksi int not null primary key auto_increment,
id_list_menu int,
id_ekstra_menu int,
tanggal date);
insert into transaksi(id_list_menu,id_ekstra_menu,tanggal)values(1,1,"2020-07-20");
insert into transaksi(id_list_menu,id_ekstra_menu,tanggal)values(2,2,"2020-07-20");
insert into transaksi(id_list_menu,id_ekstra_menu,tanggal)values(4,3,"2020-07-20");

create table list_menu(
id_list_menu int not null primary key auto_increment,
tanggal date,
id_jenis int,
id_menu int,
id_harga_menu int,
id_stok_menu int);
insert into list_menu(tanggal,id_jenis,id_menu,id_harga_menu,id_stok_menu)values("2020-07-20",1,1,1,1);
insert into list_menu(tanggal,id_jenis,id_menu,id_harga_menu,id_stok_menu)values("2020-07-20",1,2,2,2);
insert into list_menu(tanggal,id_jenis,id_menu,id_harga_menu,id_stok_menu)values("2020-07-20",2,3,3,3);
insert into list_menu(tanggal,id_jenis,id_menu,id_harga_menu,id_stok_menu)values("2020-07-20",2,4,4,4);

select * from jenis;
select * from menu;
select * from harga_menu;
select * from stok_menu;
select * from ekstra_menu;

select l.tanggal,j.nama_jenis,m.nama_menu,h.harga,s.stok from jenis j 
join menu m on m.id_jenis = j.id_jenis
join harga_menu h on h.id_menu = m.id_menu
join stok_menu s on s.id_menu = m.id_menu
join list_menu l on l.id_menu = m.id_menu;

select l.id_list_menu,l.tanggal,j.nama_jenis,m.nama_menu,h.harga,s.stok
from list_menu l
join jenis j on l.id_jenis = j.id_jenis
join menu m on m.id_menu = l.id_menu
join harga_menu h on h.id_menu = l.id_menu
join stok_menu s on s.id_menu = l.id_menu;

select * from (select l.id_list_menu,l.tanggal,j.nama_jenis,m.nama_menu,h.harga,s.stok,e.nama_ekstra_menu,e.harga_ekstra_menu
from list_menu l
join jenis j on l.id_jenis = j.id_jenis
join menu m on m.id_menu = l.id_menu
join harga_menu h on h.id_menu = l.id_menu
join stok_menu s on s.id_menu = l.id_menu
join ekstra_menu e on e.id_menu = m.id_menu) list_menu 
join transaksi t on t.id_list_menu = list_menu.id_list_menu;
select * from list_menu;
select * from transaksi;
select * from ekstra_menu e join menu m on e.id_menu=m.id_menu;
insert into list_menu(id_list_menu,tanggal,id_jenis,id_menu,id_harga_menu,id_stok_menu)values(?,?,?,?,?,?);

select t.id_transaksi,t.tanggal,j.nama_jenis,m.nama_menu,hm.harga,em.nama_ekstra_menu,em.harga_ekstra_menu, hm.harga + em.harga_ekstra_menu as total from transaksi t 
join list_menu lm on lm.id_list_menu = t.id_list_menu
join jenis j on j.id_jenis = lm.id_jenis
join menu m on m.id_menu = lm.id_menu
join harga_menu hm on hm.id_harga_menu = lm.id_harga_menu
join ekstra_menu em on em.id_ekstra = t.id_ekstra_menu;

select * from ekstra_menu;

select * from (select l.id_list_menu,l.tanggal,j.nama_jenis,m.nama_menu,h.harga,s.stok
from list_menu l
join jenis j on l.id_jenis = j.id_jenis
join menu m on m.id_menu = l.id_menu
join harga_menu h on h.id_harga = l.id_harga
join stok_menu s on s.id_menu = l.id_menu)list_menu join transaksi tr on tr.id_list_menu = list_menu.id_list_menu ;